-- MiniArch Client Command Library
-- Usage: loadstring(library)()
-- Then: registerCommand("fly", func), runCommand("fly"), etc.

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- ===== Notifications =====
local gui = player:WaitForChild("PlayerGui")
local container = gui:FindFirstChild("MiniArch_Notifications")
if not container then
    container = Instance.new("Frame")
    container.Size = UDim2.new(1,0,0,0)
    container.Position = UDim2.new(0,0,0,0)
    container.BackgroundTransparency = 1
    container.Name = "MiniArch_Notifications"
    container.Parent = gui
end

function notify(title, text, duration)
    duration = duration or 4
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(0,300,0,60)
    notif.Position = UDim2.new(0.5,-150,0,-70)
    notif.BackgroundColor3 = Color3.fromRGB(0,120,215)
    notif.BorderSizePixel = 0
    notif.Parent = container

    local corner = Instance.new("UICorner", notif)
    corner.CornerRadius = UDim.new(0,4)

    local titleLbl = Instance.new("TextLabel", notif)
    titleLbl.Size = UDim2.new(1,-10,0,20)
    titleLbl.Position = UDim2.new(0,5,0,5)
    titleLbl.BackgroundTransparency = 1
    titleLbl.Font = Enum.Font.SourceSansBold
    titleLbl.TextColor3 = Color3.fromRGB(255,255,255)
    titleLbl.TextSize = 16
    titleLbl.Text = title
    titleLbl.TextXAlignment = Enum.TextXAlignment.Left

    local textLbl = Instance.new("TextLabel", notif)
    textLbl.Size = UDim2.new(1,-10,0,30)
    textLbl.Position = UDim2.new(0,5,0,25)
    textLbl.BackgroundTransparency = 1
    textLbl.Font = Enum.Font.SourceSans
    textLbl.TextColor3 = Color3.fromRGB(230,230,230)
    textLbl.TextSize = 14
    textLbl.Text = text
    textLbl.TextWrapped = true
    textLbl.TextXAlignment = Enum.TextXAlignment.Left
    textLbl.TextYAlignment = Enum.TextYAlignment.Top

    TweenService:Create(notif, TweenInfo.new(0.5, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5,-150,0,10)}):Play()

    delay(duration, function()
        TweenService:Create(notif, TweenInfo.new(0.5, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5,-150,0,-70), BackgroundTransparency = 1}):Play()
        game:GetService("Debris"):AddItem(notif, 0.6)
    end)
end

-- ===== Command Registry =====
local commands = {}

function registerCommand(name, func)
    commands[name:lower()] = func
end

-- Run a chat-like string command
function runCommand(msg)
    msg = msg:gsub("^%s+",""):gsub("%s+$","")
    if msg == "" then return end
    local args = {}
    for token in msg:gmatch("%S+") do table.insert(args, token) end
    local cmd = args[1] and args[1]:lower() or ""
    table.remove(args,1)
    if commands[cmd] then
        local success, err = pcall(function()
            commands[cmd](args)
        end)
        if not success then
            notify("ERROR", err, 5)
        end
    else
        notify("UNKNOWN", "Command not found: "..cmd, 3)
    end
end

-- ===== Example Mobile Fly Command =====
registerCommand("fly", function(args)
    local character = player.Character
    if not character then
        notify("FLY ERROR", "Character not loaded.", 4)
        return
    end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then
        notify("FLY ERROR", "No HumanoidRootPart found.", 4)
        return
    end
    if character:FindFirstChild("FlyControl") then
        character.FlyControl:Destroy()
        notify("FLY", "Fly disabled.", 3)
        return
    end
    local bv = Instance.new("BodyVelocity")
    bv.Name = "FlyControl"
    bv.MaxForce = Vector3.new(400000,400000,400000)
    bv.Velocity = Vector3.new(0,0,0)
    bv.Parent = hrp
    notify("FLY", "Fly enabled. Use joystick to move.", 5)

    local RunService = game:GetService("RunService")
    local PlayerModule = require(player:WaitForChild("PlayerScripts"):WaitForChild("PlayerModule"))
    local PlayerControls = PlayerModule:GetControls()

    local conn
    conn = RunService.RenderStepped:Connect(function()
        if not hrp or not hrp.Parent or not character:FindFirstChild("FlyControl") then
            conn:Disconnect()
            return
        end
        local moveVec = Vector3.new(0,0,0)
        if PlayerControls.TouchMovementEnabled then
            local thumb = PlayerControls:GetThumbstickPosition()
            local cam = workspace.CurrentCamera
            moveVec = (cam.CFrame.RightVector * thumb.X + cam.CFrame.LookVector * thumb.Y)
        end
        bv.Velocity = moveVec.Magnitude > 0 and moveVec.Unit*50 or Vector3.new(0,0,0)
    end)
end)

notify("MiniArch Loaded", "Client command library ready.", 4)
